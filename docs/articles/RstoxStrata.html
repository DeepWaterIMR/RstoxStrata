<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Estimation of strata with RstoxStrata • RstoxStrata</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Estimation of strata with RstoxStrata">
<meta property="og:description" content="RstoxStrata">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">RstoxStrata</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.8</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/RstoxStrata.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Examples.html">Gallery of strata system examples</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/DeepWaterIMR/RstoxStrata/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Estimation of strata with RstoxStrata</h1>
                        <h4 data-toc-skip class="author">Mikko Vihtakari (Institute of Marine Research)</h4>
            
            <h4 data-toc-skip class="date">31 January, 2022</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/DeepWaterIMR/RstoxStrata/blob/HEAD/vignettes/RstoxStrata.Rmd" class="external-link"><code>vignettes/RstoxStrata.Rmd</code></a></small>
      <div class="hidden name"><code>RstoxStrata.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>Blap</p>
<p>Packages required to run the examples:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/" class="external-link">tibble</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://DeepWaterIMR.github.io/RstoxStrata/" class="external-link">RstoxStrata</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mikkovihtakari.github.io/ggOceanMaps/" class="external-link">ggOceanMaps</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://wilkelab.org/cowplot/" class="external-link">cowplot</a></span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Fisheries assessment models use catch data and population trends to estimate the fishing quota (Total Allowable Catch, TAC), i.e., the safe or optimal biomass to remove from a population to ensure sustainable fishing. While catch data primarily govern the absolute levels in TAC estimates, population trends dictate the relative changes in TAC from year to year and help the assessment model differentiate fishing effort- and efficiency-related catch variations from actual population fluctuations. Therefore, estimating population trends is integral to fisheries assessment and can have considerable economic and ecologic consequences.</p>
<p>Estimating population trends requires deciphering how much fish there is in the sea, commonly done using survey indices tailored for a particular species, region, and sampling setup. In essence, these survey indices are estimated by summing up numbers or weights of fish within areas called strata. The strata model distribution of a stock within a particular region of interest - often delimited by political or population boundaries. Most survey indices use multiple strata, assuming that the abundance of a species, population structure, or sampling setup considerably differs within the region of interest. The formula for estimating the number (or weight) of fish within a stratum for gear that covers an area, such as trawls, multiplies an average number of fish per areal unit (=density) by area of the stratum. In other words, the density of fish in each stratum is weighted by the area. Since the area is a multiplier, it considerably impacts the outcome. Imprecision in the areal estimation of strata or missing samples within a stratum may greatly affect the estimated population trends and hence TAC.</p>
<p>Depth is among the best factors to describe the distribution of fish species [REFS]. Consequently, bottom depth intervals are commonly incorporated into strata to model the vertical distribution of a species. Using bottom depth can lead to imprecision in areal estimation for species that inhabit narrow depth ranges along the continental slopes, such as the Greenland halibut. Imprecision in the areal estimation stemming from poorly charted bathymetry and low or inconsistent model resolution can be an order of magnitude and directly proportional to survey index estimates.</p>
<p>Here we suggest a transparent framework to estimate strata from bathymetric grid data programmed to an R package called <a href="https://deepwaterimr.github.io/RstoxStrata/" class="external-link">RstoxStrata</a>, which is integrated into the <a href="https://stoxproject.github.io/" class="external-link">StoX software</a> for survey index calculation. We discuss pitfalls in making strata for survey indices, allocating stations to strata and using them to calculate survey indices. We use the main survey for <a href="https://www.ices.dk/sites/pub/Publication%20Reports/Advice/2021/2021/ghl.27.1-2.pdf" class="external-link">Northeast Arctic Greenland halibut</a> as an example contrasting two approaches to allocate stations to strata: a bottom depth-latitude based approach used in the current assesment model, and a solely position-based approach used by the StoX software. While the framework is applied to bottom depth, it can be used for any gridded spatial data such as surface temperature, salinity, or modeled prey density.</p>
</div>
<div class="section level2">
<h2 id="material-and-methods">Material and methods<a class="anchor" aria-label="anchor" href="#material-and-methods"></a>
</h2>
<p>The proposed way of defining strata attempts to simplify the strata making. Further, the process is transparent and reproducible. The distribution of a species is modeled using two components: 1) geographic regions (rectangles, called geostrata) are used to model the spatial distribution, and 2) bottom depth intervals within the geographic regions are used as a proxy of the vertical distribution. The depth data are acquired from the highest openly available evenly gridded <strong>depth model</strong> at the time of writing, the <a href="https://www.gebco.net/data_and_products/gridded_bathymetry_data/" class="external-link">General Bathymetric Chart of the Oceans</a> 15-arcsecond 2021 grid (approximately 1/4 nautical miles in the latitude direction). The <em>GEBCO_2021 Grid (ice surface elevation)</em> netCDF file is downloaded (4 Gb) and placed in a central location on the computer:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">link</span> <span class="op">&lt;-</span> <span class="st">"~/Desktop/gebco_2021/GEBCO_2021.nc"</span></code></pre></div>
<p>We use the “EggaNord” survey in the Northeast Atlantic spawning grounds of Greenland halibut as an example. The survey and its strata system are used to estimate the primary stock index for <a href="https://www.ices.dk/sites/pub/Publication%20Reports/Advice/2021/2021/ghl.27.1-2.pdf" class="external-link">Northeast Arctic Greenland halibut</a>. The original system assigns stations to strata based on latitude and bottom depth at the beginning of trawling <span class="citation">[@Høines2008]</span>, while the StoX software uses position only in the assignment <span class="citation">[@Johnsen2019]</span> (Table <a href="#tab:origareas">1</a>). The calculus for areas of the strata used in the original system has been lost and is not reproducible. Since the new StoX based approach uses solely position in station allocation to strata, we need to define the longitude limits as well to mimic the old strata system.</p>
<table class="table table table-striped table-condensed" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:origareas">Table 1: </span>Previously used strata system definition for NEA Greenland halibut. Latitude intervals are given as columns, depth intervals as rows, and the numbers represent strata areas in square nautical miles.
</caption>
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
76-80
</th>
<th style="text-align:right;">
73.5-76
</th>
<th style="text-align:right;">
70.5-73.5
</th>
<th style="text-align:right;">
68-70.5
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
1000-1500
</td>
<td style="text-align:right;">
2693
</td>
<td style="text-align:right;">
1672
</td>
<td style="text-align:right;">
3272
</td>
<td style="text-align:right;">
945
</td>
</tr>
<tr>
<td style="text-align:left;">
700-1000
</td>
<td style="text-align:right;">
1263
</td>
<td style="text-align:right;">
761
</td>
<td style="text-align:right;">
1706
</td>
<td style="text-align:right;">
1150
</td>
</tr>
<tr>
<td style="text-align:left;">
500-700
</td>
<td style="text-align:right;">
702
</td>
<td style="text-align:right;">
488
</td>
<td style="text-align:right;">
1324
</td>
<td style="text-align:right;">
525
</td>
</tr>
<tr>
<td style="text-align:left;">
400-500
</td>
<td style="text-align:right;">
1440
</td>
<td style="text-align:right;">
575
</td>
<td style="text-align:right;">
1228
</td>
<td style="text-align:right;">
400
</td>
</tr>
</tbody>
</table>
<div class="section level3">
<h3 id="geostrata">Geostrata<a class="anchor" aria-label="anchor" href="#geostrata"></a>
</h3>
<p>The geographic rectangles, called “<strong>geostrata</strong>”, are defined as a data frame for the <a href="https://deepwaterimr.github.io/RstoxStrata/" class="external-link">RstoxStrata</a> package. Optionally, the first column of the data frame can define the names of the geostrata. The four following numeric columns are required and define the minimum and maximum longitude as well as minimum and maximum latitude for the rectangles, respectively (Figure <a href="#fig:geostrata">1</a>). The coordinates are defined in decimal degrees (<a href="https://epsg.io/4326" class="external-link">WGS84 / EPSG:4326</a>).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">geostrata.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>
  lon.min <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">10</span>, <span class="fl">10</span>, <span class="fl">8</span><span class="op">)</span>,
  lon.max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">16</span>, <span class="fl">17.5</span>, <span class="fl">17.5</span>, <span class="fl">17.5</span><span class="op">)</span>,
  lat.min <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">76</span>, <span class="fl">73.5</span>, <span class="fl">70.5</span>, <span class="fl">68</span><span class="op">)</span>,
  lat.max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">80</span>, <span class="fl">76</span>, <span class="fl">73.5</span>, <span class="fl">70.5</span><span class="op">)</span>
<span class="op">)</span>

<span class="fu"><a href="../reference/plotGeostrata.html">plotGeostrata</a></span><span class="op">(</span><span class="va">geostrata.df</span><span class="op">)</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:geostrata"></span>
<img src="RstoxStrata_files/figure-html/geostrata-1.png" alt="A geostrata system attempting to mimic the EggaNord survey strata for Northeast Greenland halibut. The official system uses latitude and bottom depth at the beginning of trawling for station allocation while the new StoX based approach uses position only." width="672"><p class="caption">
Figure 1: A geostrata system attempting to mimic the EggaNord survey strata for Northeast Greenland halibut. The official system uses latitude and bottom depth at the beginning of trawling for station allocation while the new StoX based approach uses position only.
</p>
</div>
</div>
<div class="section level3">
<h3 id="depth-strata">Depth strata<a class="anchor" aria-label="anchor" href="#depth-strata"></a>
</h3>
<p>The <strong>depth strata</strong> are defined as a numeric vector specifying the cut points for the depth intervals.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">depths.vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">400</span>, <span class="fl">500</span>, <span class="fl">700</span>, <span class="fl">1000</span>, <span class="fl">1500</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="strata-estimation">Strata estimation<a class="anchor" aria-label="anchor" href="#strata-estimation"></a>
</h3>
<p>The <a href="https://www.gebco.net/data_and_products/gridded_bathymetry_data/" class="external-link">GEBCO bathymetry model</a> covers the entire world. Clipping the grid to a region of interest greatly reduces up the computation time. The clipping is done using the <strong>boundary</strong> argument which accepts vectors with four numbers in the same order than geostrata (minimum and maximum longitude, minimum and maximum latitude).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">boundary.vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">17.5</span>, <span class="fl">68</span>, <span class="fl">80</span><span class="op">)</span></code></pre></div>
<p>These information can then be input into the <a href="https://deepwaterimr.github.io/RstoxStrata/reference/strataPolygon.html" class="external-link"><code>strataPolygon()</code></a> function which performs the strata estimation. The function returns a <code>strataPolygon</code> object, which is a list containing <strong>strata</strong> and <strong>geostrata</strong> <a href="https://cran.r-project.org/web/packages/sf/index.html" class="external-link">sf</a> polygon objects. <code>strataPolygon</code> objects have their own plotting method utilizing the <a href="https://cran.r-project.org/web/packages/ggOceanMaps/index.html" class="external-link">ggOceanMaps</a> package, but you can also plot the <code>sf</code> objects using standard syntax.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pols</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/strataPolygon.html">strataPolygon</a></span><span class="op">(</span>
  bathy <span class="op">=</span> <span class="va">link</span>, 
  depths <span class="op">=</span> <span class="va">depths.vec</span>, 
  boundary <span class="op">=</span> <span class="va">boundary.vec</span>,
  geostrata <span class="op">=</span> <span class="va">geostrata.df</span>
<span class="op">)</span>

<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pols</span><span class="op">)</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:stratawithfrags"></span>
<img src="RstoxStrata_files/figure-html/stratawithfrags-1.png" alt="Initial strata system for the EggaNord survey index containing fragments that increase the strata area" width="672"><p class="caption">
Figure 2: Initial strata system for the EggaNord survey index containing fragments that increase the strata area
</p>
</div>
<p>The depth strata 400-500 m between geostrata B and C is large and exceeds regularly visited stations. The <a href="https://deepwaterimr.github.io/RstoxStrata/reference/strataPolygon.html" class="external-link"><code>strataPolygon()</code></a> function accepts polygons as the <code>boundary</code> argument allowing manual tuning of the strata (Figures <a href="#fig:boundary">3</a> and <a href="#fig:strata">4</a>). We formulate a spatial polygon using QGIS and tune the polygon such that the estimated area of C 400-500 m matches the official area. The polygon is included in the RstoxStrata package as example data:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">boundary</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">read_sf</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"shapes"</span>, <span class="st">"boundary_shape.shp"</span>, package <span class="op">=</span> <span class="st">"RstoxStrata"</span><span class="op">)</span><span class="op">)</span>

<span class="fu">ggOceanMaps</span><span class="fu">::</span><span class="fu"><a href="https://mikkovihtakari.github.io/ggOceanMaps/reference/qmap.html" class="external-link">qmap</a></span><span class="op">(</span><span class="va">boundary</span><span class="op">)</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:boundary"></span>
<img src="RstoxStrata_files/figure-html/boundary-1.png" alt="Spatial polygons can be used as the boundary argument within strataPolygons() to manually restrict the strata extend." width="672"><p class="caption">
Figure 3: Spatial polygons can be used as the boundary argument within strataPolygons() to manually restrict the strata extend.
</p>
</div>
<p>The initial strata system contains <strong>fragments</strong> from sea mounts and fjords. These fragments bias the area of strata and can be removed using the <code>fragment.area</code> argument which accepts a single threshold in square kilometers. Fragments smaller than the threshold will be removed. The process of finding the correct threshold is iterative.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">pols</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/strataPolygon.html">strataPolygon</a></span><span class="op">(</span>
  bathy <span class="op">=</span> <span class="va">link</span>, 
  depths <span class="op">=</span> <span class="va">depths.vec</span>, 
  boundary <span class="op">=</span> <span class="va">boundary</span>,
  geostrata <span class="op">=</span> <span class="va">geostrata.df</span>,
  fragment.area <span class="op">=</span> <span class="fl">400</span>
<span class="op">)</span>

<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pols</span>, facetted <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:strata"></span>
<img src="RstoxStrata_files/figure-html/strata-1.png" alt="Final strata system for the EggaNord survey to estimate a survey index for Northeast Arctic Greenland halibut. The strata system attemps to mimic the system used in the assessment that bases on latitude and gear depth." width="672"><p class="caption">
Figure 4: Final strata system for the EggaNord survey to estimate a survey index for Northeast Arctic Greenland halibut. The strata system attemps to mimic the system used in the assessment that bases on latitude and gear depth.
</p>
</div>
</div>
<div class="section level3">
<h3 id="survey-index">Survey index<a class="anchor" aria-label="anchor" href="#survey-index"></a>
</h3>
<p>Trawl data from the EggaNord survey was used to calculate the survey indices. Biomass of Greenland halibut in all trawl hauls taken during the survey from 1994 until 2021 are included in the <a href="https://deepwaterimr.github.io/RstoxStrata/reference/eggan_ghl.html" class="external-link"><code>data(eggan_ghl)</code></a> dataset. Swept area density (<span class="math inline">\(\rho\)</span>, called density in the dataset) was calculated as biomass in kg per square nautical mile assuming 80 m as the effective fishing width for all trawls:</p>
<p><span class="math display">\[\rho_i = (\frac{B_i [kg]}{d_i [nmi] * (80 [m]/1852 [m]) [nmi]}) [kg/nmi^2]\]</span>
Where <em>i</em> is a trawl station, <span class="math inline">\(B_i\)</span> biomass of Greenland halibut, and <span class="math inline">\(d_i\)</span> trawling distance on that stations. Units are given in square brackets.</p>
<p>Indices for each stratum were calculated as average <span class="math inline">\(\rho\)</span> for a stratum multiplied by area of the stratum.</p>
<p><span class="math display">\[ I_s = (A_s [nmi^2] \times \sum_{i=1}^n \frac{\rho_i [kg/nmi^2]}{n}) [kg]\]</span>
Where <em>s</em> is a stratum, <span class="math inline">\(A_s\)</span> area of that stratum, <em>i</em> a trawl station, and <em>n</em> number of stations within the stratum.</p>
<p>The indices for each stratum were then summed up to formulate an annual survey index value.</p>
<p><span class="math display">\[ I_y = \sum_{s=1}^{n_s} I_s\]</span>
Where <em>y</em> is a year, <em>s</em> a stratum, and <span class="math inline">\(n_s\)</span> number of strata included in the survey index. This survey index is referred to as “recalculated” index to separate it from the official numbers that have directly been acquired from the assessment model. The recalculated index was compared to the official numbers to confirm the calculus.</p>
<!-- Write this when you know -->
<!-- Confidence intervals for the survey indices were calculated from standard deviations using 0.025 and 0.975 quantiles from t-distribution ($\pm t_{n -1}(0.975) \times s/\sqrt(n)$). Variances were calculated separately for each stratum. The annual standard deviation for the index was calculated as square rooted summed variances ($s = \sqrt(\sum \sigma_{i}^2)$, where i is $\rho$ for a trawl station). -->
<p>The survey index calculations have been done using the hidden code under:</p>
<details><summary>
Code for survey index calculations
</summary><div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">eggan_ghl</span><span class="op">)</span>

<span class="va">stn</span> <span class="op">&lt;-</span> <span class="va">eggan_ghl</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>depth.interval <span class="op">=</span>
           <span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span><span class="va">.</span><span class="op">$</span><span class="va">bottomdepthstart</span>, <span class="va">depths.vec</span>,
               labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">depths.vec</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">depths.vec</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span>,
                              <span class="va">depths.vec</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">depths.vec</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>, sep <span class="op">=</span> <span class="st">"-"</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span>coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"longitudestart"</span>, <span class="st">"latitudestart"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span>, remove <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html" class="external-link">rownames_to_column</a></span><span class="op">(</span><span class="st">"id"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_join.html" class="external-link">st_join</a></span><span class="op">(</span><span class="va">pols</span><span class="op">$</span><span class="va">strata</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"interval"</span>, <span class="st">"geostrata.name"</span>, <span class="st">"area.nm2"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_join.html" class="external-link">st_join</a></span><span class="op">(</span><span class="va">pols</span><span class="op">$</span><span class="va">geostrata</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"geostrata.name"</span><span class="op">)</span><span class="op">]</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
            <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="st">"geostrata.polygon"</span> <span class="op">=</span> <span class="st">"geostrata.name"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_set_geometry</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>area.nm2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">area.nm2</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">.</span>,
            <span class="va">eggan_ghl_original_strata</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
              <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">geostrata.name</span>, <span class="va">interval</span>, <span class="va">orig.nm2</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
              <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="st">"geostrata.polygon"</span> <span class="op">=</span> <span class="st">"geostrata.name"</span>, <span class="st">"depth.interval"</span> <span class="op">=</span> <span class="st">"interval"</span><span class="op">)</span>
  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="st">"area.new"</span> <span class="op">=</span> <span class="st">"area.nm2"</span>, <span class="st">"area.old"</span> <span class="op">=</span> <span class="st">"orig.nm2"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html" class="external-link">relocate</a></span><span class="op">(</span><span class="va">distance</span>, <span class="va">biomass</span>, <span class="va">density</span>, .after <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">last_col</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">old_area_old_assig</span> <span class="op">&lt;-</span> <span class="va">stn</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">area.old</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">startyear</span>, <span class="va">geostrata.polygon</span>, <span class="va">depth.interval</span>, <span class="va">area.old</span>, <span class="va">density</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="st">"geostrata.name"</span> <span class="op">=</span> <span class="st">"geostrata.polygon"</span>,
         <span class="st">"interval"</span> <span class="op">=</span> <span class="st">"depth.interval"</span>,
         <span class="st">"area"</span> <span class="op">=</span> <span class="st">"area.old"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">startyear</span>, <span class="va">geostrata.name</span>, <span class="va">interval</span>, <span class="va">area</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/tidyverse.html" class="external-link">summarise</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">density</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">density</span><span class="op">)</span>, n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">area</span><span class="op">*</span><span class="va">mean</span><span class="op">/</span><span class="fl">1e6</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">startyear</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/tidyverse.html" class="external-link">summarise</a></span><span class="op">(</span>reconst <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">index</span><span class="op">)</span><span class="op">)</span>

<span class="va">surv_diff</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">official</span>, <span class="va">old_area_old_assig</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="st">"year"</span> <span class="op">=</span> <span class="st">"startyear"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>diff <span class="op">=</span> <span class="va">value</span> <span class="op">-</span> <span class="va">reconst</span><span class="op">)</span>

<span class="va">removed_stn</span> <span class="op">&lt;-</span> <span class="va">stn</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">area.new</span><span class="op">)</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">area.old</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>
    reason <span class="op">=</span> 
      <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">depth.interval</span><span class="op">)</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">geostrata.polygon</span><span class="op">)</span>, <span class="st">"Both"</span>,
             <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">depth.interval</span><span class="op">)</span>, <span class="st">"Depth"</span>,
                    <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">geostrata.polygon</span><span class="op">)</span>, <span class="st">"Outside"</span>,
                           <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">interval</span><span class="op">)</span>, <span class="st">"Position"</span> ,<span class="st">"Other"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">pb_index</span> <span class="op">&lt;-</span> <span class="va">stn</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">area.new</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="st">"geostrata"</span> <span class="op">=</span> <span class="st">"geostrata.name"</span>,
         <span class="st">"area"</span> <span class="op">=</span> <span class="st">"area.new"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">startyear</span>, <span class="va">geostrata</span>, <span class="va">interval</span>, <span class="va">area</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/tidyverse.html" class="external-link">summarise</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">density</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">density</span><span class="op">)</span>, n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">area</span><span class="op">*</span><span class="va">mean</span><span class="op">/</span><span class="fl">1e6</span>,
         index.sd <span class="op">=</span> <span class="va">area</span><span class="op">*</span><span class="va">sd</span><span class="op">/</span><span class="fl">1e6</span>,
         ci.min.t <span class="op">=</span> <span class="va">index</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">qt</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fl">0.025</span>, <span class="op">(</span><span class="va">n</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="va">index.sd</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>,
         ci.max.t <span class="op">=</span> <span class="va">index</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">qt</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fl">0.025</span>, <span class="op">(</span><span class="va">n</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="va">index.sd</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"Position"</span>, .after <span class="op">=</span> <span class="st">"interval"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">db_index</span> <span class="op">&lt;-</span> <span class="va">stn</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">area.new</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">interval</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="st">"geostrata"</span> <span class="op">=</span> <span class="st">"geostrata.polygon"</span>,
         <span class="st">"interval"</span> <span class="op">=</span> <span class="st">"depth.interval"</span>,
         <span class="st">"area"</span> <span class="op">=</span> <span class="st">"area.new"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">startyear</span>, <span class="va">geostrata</span>, <span class="va">interval</span>, <span class="va">area</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/tidyverse.html" class="external-link">summarise</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">density</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">density</span><span class="op">)</span>, n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">area</span><span class="op">*</span><span class="va">mean</span><span class="op">/</span><span class="fl">1e6</span>,
         index.sd <span class="op">=</span> <span class="va">area</span><span class="op">*</span><span class="va">sd</span><span class="op">/</span><span class="fl">1e6</span>,
         ci.min.t <span class="op">=</span> <span class="va">index</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">qt</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fl">0.025</span>, <span class="op">(</span><span class="va">n</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="va">index.sd</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>,
         ci.max.t <span class="op">=</span> <span class="va">index</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">qt</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fl">0.025</span>, <span class="op">(</span><span class="va">n</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="va">index.sd</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"Depth-latitude"</span>, .after <span class="op">=</span> <span class="st">"interval"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
</details>
</div>
</div>
<div class="section level2">
<h2 id="results">Results<a class="anchor" aria-label="anchor" href="#results"></a>
</h2>
<div class="section level3">
<h3 id="difference-in-area">Difference in area<a class="anchor" aria-label="anchor" href="#difference-in-area"></a>
</h3>
<p>The reconstructed strata areas were lower than the original for approximately half of the strata (Figure <a href="#fig:areadiff">5</a>, Table <a href="#tab:areadifftab">2</a>). Area of the deepest 1000-1500 strata, the manually adjusted strata C 400-500, geostrata A excluding the shallowest 400-500 strata, and strata B 700-1000 were within <span class="math inline">\(\pm\)</span> 7% of the original strata system.</p>
<div class="figure">
<span style="display:block;" id="fig:areadiff"></span>
<img src="RstoxStrata_files/figure-html/areadiff-1.png" alt="Difference between the original and reconstructed strata area. A) The differences are shown as a scatter plot. Color refers to depth strata and letter to geostrata name. B) The differences are shown on a map. Color refers to percentage difference. Negative percentages mean larger original area than reconstructed area." width="672"><p class="caption">
Figure 5: Difference between the original and reconstructed strata area. A) The differences are shown as a scatter plot. Color refers to depth strata and letter to geostrata name. B) The differences are shown on a map. Color refers to percentage difference. Negative percentages mean larger original area than reconstructed area.
</p>
</div>
<table class="table table table-striped table-condensed" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:areadifftab">Table 2: </span>Percentage difference between original and reconstructed strata areas. Negative percentages mean larger original area than reconstructed area. Geostrata are shown vertically and depth intervals horizontally.
</caption>
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
A
</th>
<th style="text-align:right;">
B
</th>
<th style="text-align:right;">
C
</th>
<th style="text-align:right;">
D
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
1000-1500
</td>
<td style="text-align:right;">
1.4
</td>
<td style="text-align:right;">
6.5
</td>
<td style="text-align:right;">
3.3
</td>
<td style="text-align:right;">
-3.2
</td>
</tr>
<tr>
<td style="text-align:left;">
700-1000
</td>
<td style="text-align:right;">
2.7
</td>
<td style="text-align:right;">
-2.0
</td>
<td style="text-align:right;">
-10.8
</td>
<td style="text-align:right;">
-57.6
</td>
</tr>
<tr>
<td style="text-align:left;">
500-700
</td>
<td style="text-align:right;">
-3.0
</td>
<td style="text-align:right;">
-15.0
</td>
<td style="text-align:right;">
-28.5
</td>
<td style="text-align:right;">
-34.0
</td>
</tr>
<tr>
<td style="text-align:left;">
400-500
</td>
<td style="text-align:right;">
-61.3
</td>
<td style="text-align:right;">
-35.1
</td>
<td style="text-align:right;">
-2.1
</td>
<td style="text-align:right;">
-63.6
</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="station-assignment-difference">Station assignment difference<a class="anchor" aria-label="anchor" href="#station-assignment-difference"></a>
</h3>
<p>Total of 228 stations (6.5%) were assigned differently between depth-latitude- and position-based assignment. Stations were consistently assigned to the same geostrata, but assignment to depth strata differed. Most of these stations had a bottom depth close to the depth strata boundaries (Figure <a href="#fig:differenceplot">6</a>), although some had bottom depths that were far off from the depths estimated based on position.</p>
<p>The agreement between depth-latitude and position-based station assignment to strata varied between 84 and 98 (Figure <a href="#fig:agreementplot">7</a>). The use of position based station assignment to strata led to removal of 30 stations that were included in the depth-latitude based assignment (Figure <a href="#fig:removalmap">8</a>).</p>
<div class="figure">
<span style="display:block;" id="fig:differenceplot"></span>
<img src="RstoxStrata_files/figure-html/differenceplot-1.png" alt="Bottom depth at start of trawling for stations that did not get assigned to the same depth strata between depth-latitude- and position-based assignment. Position-based strata are shown on the x-axis together with the depth interval (grey bar). Dots represent stations. The color of dots indicates position-based strata." width="672"><p class="caption">
Figure 6: Bottom depth at start of trawling for stations that did not get assigned to the same depth strata between depth-latitude- and position-based assignment. Position-based strata are shown on the x-axis together with the depth interval (grey bar). Dots represent stations. The color of dots indicates position-based strata.
</p>
</div>
<div class="figure">
<span style="display:block;" id="fig:agreementplot"></span>
<img src="RstoxStrata_files/figure-html/agreementplot-1.png" alt="Percent agreement in station allocation to strata between the depth-latitude-based (current assessment) and position-based (StoX) assignment. Size of the bubbles and number inside them refer to the percentage. Fill of the bubbles refer to number of stations. The figure contains all stations sampled during the EggaN survey 1004-2021. Geostrata are shown vertically and depth intervals horizontally." width="672"><p class="caption">
Figure 7: Percent agreement in station allocation to strata between the depth-latitude-based (current assessment) and position-based (StoX) assignment. Size of the bubbles and number inside them refer to the percentage. Fill of the bubbles refer to number of stations. The figure contains all stations sampled during the EggaN survey 1004-2021. Geostrata are shown vertically and depth intervals horizontally.
</p>
</div>
<div class="figure">
<span style="display:block;" id="fig:removalmap"></span>
<img src="RstoxStrata_files/figure-html/removalmap-1.png" alt="Position of EggaN survey stations removed from survey index calculations. The color indicates the reason for removal: depth = the recorded bottom depth is outside the depth strata; outside = position of the station is outside the geostrata; position = position of the station is outside the strata due to impression in bathymetry model and strata estimation or due to wrongly recorded coordinates; and both = both conditions 'depth' and 'outside' apply. Grey dots indicate stations included in survey index calculations. The figure contains data from all years (1994-2021)." width="672"><p class="caption">
Figure 8: Position of EggaN survey stations removed from survey index calculations. The color indicates the reason for removal: depth = the recorded bottom depth is outside the depth strata; outside = position of the station is outside the geostrata; position = position of the station is outside the strata due to impression in bathymetry model and strata estimation or due to wrongly recorded coordinates; and both = both conditions ‘depth’ and ‘outside’ apply. Grey dots indicate stations included in survey index calculations. The figure contains data from all years (1994-2021).
</p>
</div>
<div class="figure">
<span style="display:block;" id="fig:removalyears"></span>
<img src="RstoxStrata_files/figure-html/removalyears-1.png" alt="Number of EggaN stations per year that get assigned to different depth strata between the depth-latitude- and position-based regimes." width="672"><p class="caption">
Figure 9: Number of EggaN stations per year that get assigned to different depth strata between the depth-latitude- and position-based regimes.
</p>
</div>
</div>
<div class="section level3">
<h3 id="difference-in-survey-index">Difference in survey index<a class="anchor" aria-label="anchor" href="#difference-in-survey-index"></a>
</h3>
<p>The reconstructed survey index using depth- and latitude-based station assignment to strata and the original strata areas had a Pearson correlation of 0.997 with the official EggaN survey index used in the assessment model (Figure <a href="#fig:compwithofficial">10</a>A). The average annual difference between these indices was 38 tons and standard deviation 1189 tons (Figure <a href="#fig:compwithofficial">10</a>B). For comparison purposes the official and reconstructed survey indices were practically identical. The difference is likely caused by a few stations being included/removed from survey index calculations differently and highlights the differences weighing by the area can cause to survey indices. Only the reconstructed survey index is used in the comparison for consistency.</p>
<div class="figure">
<span style="display:block;" id="fig:compwithofficial"></span>
<img src="RstoxStrata_files/figure-html/compwithofficial-1.png" alt="Comparison between the official EggaN survey index used in the assessement and recalculated index using depth-latitude based assignment and official (old) strata areas. A) Scatter plot. The line indicates x = y (1-to-1 relationship). Numbers refer to the two first numbers in year. B) Official minus the reconstructed index." width="672"><p class="caption">
Figure 10: Comparison between the official EggaN survey index used in the assessement and recalculated index using depth-latitude based assignment and official (old) strata areas. A) Scatter plot. The line indicates x = y (1-to-1 relationship). Numbers refer to the two first numbers in year. B) Official minus the reconstructed index.
</p>
</div>
<p>The difference between original and reconstructed strata <strong>areas</strong> on the index based on depth- and latitude station assignment was influenced by outliers (Figure <a href="#fig:areainfl">11</a>). The best fit (Pearson correlation of 0.713) was acquired by removing strata with one station per year before summing up indices for each strata (<span class="math inline">\(I_s\)</span>, Figure <a href="#fig:areainfl">11</a>B).</p>
<div class="figure">
<span style="display:block;" id="fig:areainfl"></span>
<img src="RstoxStrata_files/figure-html/areainfl-1.png" alt="The influence of outliers on the difference between the depth-latitude-based indices calculated using the official (old) and reconstructed strata areas. Threshold for minimum number of stations per strata is indicated using color. A) Differences among years. B) Annual mean differences. Error bars indicate 95% confidence intervals assuming normal distribution." width="672"><p class="caption">
Figure 11: The influence of outliers on the difference between the depth-latitude-based indices calculated using the official (old) and reconstructed strata areas. Threshold for minimum number of stations per strata is indicated using color. A) Differences among years. B) Annual mean differences. Error bars indicate 95% confidence intervals assuming normal distribution.
</p>
</div>
<p>Biadf</p>
<div class="figure">
<span style="display:block;" id="fig:assigmentinfl"></span>
<img src="RstoxStrata_files/figure-html/assigmentinfl-1.png" alt="The influence of outliers on the difference between the depth-latitude- and position-based indices calculated using the reconstructed strata areas. Threshold for minimum number of stations per strata is indicated using color. A) Differences among years. B) Annual mean differences. Error bars indicate 95% confidence intervals assuming normal distribution." width="672"><p class="caption">
Figure 12: The influence of outliers on the difference between the depth-latitude- and position-based indices calculated using the reconstructed strata areas. Threshold for minimum number of stations per strata is indicated using color. A) Differences among years. B) Annual mean differences. Error bars indicate 95% confidence intervals assuming normal distribution.
</p>
</div>
<p>Consequently, this alternative was used in depth-latitude and position-based station assignment comparisons.</p>
<div class="figure">
<span style="display:block;" id="fig:indexdiff"></span>
<img src="RstoxStrata_files/figure-html/indexdiff-1.png" alt="Blap" width="672"><p class="caption">
Figure 13: Blap
</p>
</div>
<p>Number of stations per strata</p>
<p>Impact of geo- and depth strata on the index figure</p>
<p>Correlation between geo- and depth strata figure</p>
</div>
</div>
<div class="section level2">
<h2 id="discussion">Discussion<a class="anchor" aria-label="anchor" href="#discussion"></a>
</h2>
<p>There are no obvious reasons for lower areas of the reconstructed strata but since the method for acquiring the original strata areas is lost and over a decade old, the reconstructed areas are likely more trustworthy than the old ones.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Mikko Vihtakari.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
